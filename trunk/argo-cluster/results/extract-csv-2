#!/bin/bash

domain=$1
problem=$2

# create directory for datafiles
mkdir -p data

# locate files
#echo phase0
if [ "$domain" == "race" -o "$domain" == "ctp2" -o "$domain" == "ctp3" ]; then
    FILES=`grep -l $problem raw/*/output.*`
elif [ "$domain" == "sailing" ]; then
    FILES=`grep $domain raw/*/output.* | awk '{ if( $11 == problem ) print $1; }' problem=$problem | cut -f1 -d:`
else
    FILES=`grep $domain raw/*/output.* | awk '{ if( $9 == problem ) print $1; }' problem=$problem | cut -f1 -d:`
fi

if [ "$FILES" == "" ]; then
    echo No files for problem \'$problem\'
    exit 0
fi

# extract data from files
grep -h "decisions)" $FILES |
  awk 'BEGIN { FS="[=,() ]"; } \
             { if( $1 == "optimal" || $1 == "greedy" || $1 == "random" ) {
                   printf "%s,%s,%s,NA,NA,NA,NA,NA,%s,%s,%s,%s\n",domain,problem,$1,$3,$4,$7,$9;
               } else if( $1 == "ao3" || $1 == "ao4" || $1 == "aot" || $1 == "aot*" || $1 == "aot-random" || $1 == "aot-value" || $1 == "aot2" || $1 == "aot-value2" ) {
                   printf "%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s\n",domain,problem,$1,$2,$4,$6,$8,$10,$13,$14,$17,$19;
               } else {
                   printf "%s,%s,%s,%s,%s,%s,%s,NA,%s,%s,%s,%s\n",domain,problem,$1,$2,$4,$6,$8,$11,$12,$15,$17;
               }
             }' domain=$domain problem=$problem >> data/$problem.csv

